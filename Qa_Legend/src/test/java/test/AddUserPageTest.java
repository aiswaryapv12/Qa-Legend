package test;

import java.time.Duration;
import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.Test;

import automation_core.Base;
import utilities.Excel_Utility;
import utilities.RandomData_Utility;


public class AddUserPageTest extends Base {
	
	@Test
	public void  verifyAddUser()
	{
		WebElement username_field = driver.findElement(By.xpath("//input[@id='username']"));
		String username_value=Excel_Utility.readStringData(0, 0,"Login_Page");
		username_field.sendKeys(username_value);
		WebElement password_field =driver.findElement(By.xpath("//input[@id='password']"));
		String password_value =Excel_Utility.readIntegerData(0, 1,"Login_Page");
		password_field.sendKeys(password_value);
		WebElement login_button = driver.findElement(By.xpath("//button[@class='btn btn-primary']"));
		login_button.click();
		WebElement endtour_field=driver.findElement(By.xpath("//button[@class='btn btn-default btn-sm']"));
		endtour_field.click();
		WebElement user_managementfield = driver.findElement(By.xpath("//span[text()='User Management']"));
		user_managementfield.click();
		
		WebDriverWait wait =new WebDriverWait(driver,Duration.ofSeconds(20));
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//span[@class='title' and contains(text(),'Users')]")));
		WebElement users_field= driver.findElement(By.xpath("//span[@class='title' and contains(text(),'Users')]"));
		users_field.click();
		WebElement add_field =driver.findElement(By.xpath("//a[@class='btn btn-block btn-primary']"));
		add_field.click();
		String prefix =RandomData_Utility.getPrefix();
		String first_name= RandomData_Utility.getFirtName();
		String last_name=RandomData_Utility.getLastName();
		String email= first_name+last_name+"@gmail.com";
		String salepercent =RandomData_Utility.getPercent();
		String username =first_name+last_name;
		String password = first_name+"123"+last_name;
		
		WebElement prefix_field =driver.findElement(By.xpath("//input[@id='surname']"));
		prefix_field.sendKeys(prefix);
		
		WebElement firstname_field =driver.findElement(By.xpath("//input[@id='first_name']"));
		firstname_field.sendKeys(first_name);
		
		WebElement lastname_field = driver.findElement(By.xpath("//input[@id='last_name']"));
		lastname_field.sendKeys(last_name);
		
		WebElement email_field = driver.findElement(By.xpath("//input[@id='email']"));
		email_field.sendKeys(email);
		
		WebElement role_field = driver.findElement(By.xpath("//select[@id='role']"));
		Select dropdown= new Select(role_field);
		dropdown.selectByIndex(3);
		
		WebElement username_field1 = driver.findElement(By.xpath("//input[@id='username']"));
		username_field1.sendKeys(username);
		
		WebElement password_field1 = driver.findElement(By.xpath("//input[@id='password']"));
		password_field1.sendKeys(password);
		
		WebElement confirmpassword_field1 = driver.findElement(By.xpath("//input[@id='confirm_password']"));
		confirmpassword_field1.sendKeys(password);
		
		WebElement salecommission_field = driver.findElement(By.xpath("//input[@id='cmmsn_percent']"));
		salecommission_field.sendKeys(salepercent);
		
		WebElement save_field = driver.findElement(By.xpath("//button[@id='submit_user_button']"));
		save_field.click();
			
		WebElement search_field = driver.findElement(By.xpath("//input[@class='form-control input-sm']"));
		search_field.sendKeys(username);
		
		WebElement webtable =driver.findElement(By.xpath("//table[@id='users_table']//tbody"));
		List<WebElement> row =webtable.findElements(By.tagName("tr"));
		int rowsize = row.size();
		for(int i = 0;i<rowsize;i++)
		{
			 List<WebElement> column =row.get(i).findElements(By.tagName("th"));
			 int columnsize = column.size();
			 for(int j=0;j<columnsize;j++)
			 {
				 String celltext = column.get(j).getText();
				 
				 if(celltext.equals("Name"))
				 {
					 System.out.println(column.get(1).getText());
				 }
			 }
		
	
		}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	
	}


@Test
public void verifyUserLoginWithNewlyAddUser()
{
			
		WebElement username_field = driver.findElement(By.xpath("//input[@id='username']"));
		String username_value=Excel_Utility.readStringData(0, 0,"Login_Page");
		username_field.sendKeys(username_value);
		WebElement password_field =driver.findElement(By.xpath("//input[@id='password']"));
		String password_value =Excel_Utility.readIntegerData(0, 1,"Login_Page");
		password_field.sendKeys(password_value);
		WebElement login_button = driver.findElement(By.xpath("//button[@class='btn btn-primary']"));
		login_button.click();
		WebElement endtour_field=driver.findElement(By.xpath("//button[@class='btn btn-default btn-sm']"));
		endtour_field.click();
		WebElement user_managementfield = driver.findElement(By.xpath("//span[text()='User Management']"));
		user_managementfield.click();
		
		WebDriverWait wait =new WebDriverWait(driver,Duration.ofSeconds(20));
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//span[@class='title' and contains(text(),'Users')]")));
		WebElement users_field= driver.findElement(By.xpath("//span[@class='title' and contains(text(),'Users')]"));
		users_field.click();
		WebElement add_field =driver.findElement(By.xpath("//a[@class='btn btn-block btn-primary']"));
		add_field.click();
		String prefix =RandomData_Utility.getPrefix();
		String first_name= RandomData_Utility.getFirtName();
		String last_name=RandomData_Utility.getLastName();
		String email= first_name+last_name+"@gmail.com";
		String salepercent =RandomData_Utility.getPercent();
		String username =first_name+last_name;
		String password = first_name+"123"+last_name;
		
		WebElement prefix_field =driver.findElement(By.xpath("//input[@id='surname']"));
		prefix_field.sendKeys(prefix);
		
		WebElement firstname_field =driver.findElement(By.xpath("//input[@id='first_name']"));
		firstname_field.sendKeys(first_name);
		
		WebElement lastname_field = driver.findElement(By.xpath("//input[@id='last_name']"));
		lastname_field.sendKeys(last_name);
		
		WebElement email_field = driver.findElement(By.xpath("//input[@id='email']"));
		email_field.sendKeys(email);
		
		WebElement role_field = driver.findElement(By.xpath("//select[@id='role']"));
		Select dropdown= new Select(role_field);
		dropdown.selectByIndex(3);
		
		WebElement username_field1 = driver.findElement(By.xpath("//input[@id='username']"));
		username_field1.sendKeys(username);
		
		WebElement password_field1 = driver.findElement(By.xpath("//input[@id='password']"));
		password_field1.sendKeys(password);
		
		WebElement confirmpassword_field1 = driver.findElement(By.xpath("//input[@id='confirm_password']"));
		confirmpassword_field1.sendKeys(password);
		
		WebElement salecommission_field = driver.findElement(By.xpath("//input[@id='cmmsn_percent']"));
		salecommission_field.sendKeys(salepercent);
		
		WebElement save_field = driver.findElement(By.xpath("//button[@id='submit_user_button']"));
		save_field.click();
			
		driver.navigate().to("https://qalegend.com/billing/public/home");
		
		WebElement profile_field = driver.findElement(By.xpath("//a[@class='dropdown-toggle']"));
		profile_field.click();
		
		WebElement signout_field = driver.findElement(By.xpath("//a[text()='Sign Out']"));
		signout_field.click();
		
		WebElement username_field2 = driver.findElement(By.xpath("//input[@id='username']"));
		username_field2.sendKeys(username);
		
		WebElement password_field2 =driver.findElement(By.xpath("//input[@id='password']"));
		password_field2.sendKeys(password);
		
		WebElement login_button2 = driver.findElement(By.xpath("//button[@class='btn btn-primary']"));
		login_button2.click();
		
		WebElement actualmessage_field=driver.findElement(By.xpath("//section[@class='content-header']"));
		String actual_message=actualmessage_field.getText();
		String expected_message="Welcome"+" "+first_name+",";
		Assert.assertEquals(actual_message, expected_message,"Invalid user");
}
}

